version: '3.9'

services:
  database:
    container_name: bot-database
    image: postgres:alpine
    expose:
      - "5432"
    ports:
      - 5432:5432
    volumes:
      - ./database/data:/var/lib/postgres/data
    environment:
      POSTGRES_DB: "bot"
      POSTGRES_USER: "root"
      POSTGRES_PASSWORD: "root"
    deploy:
      replicas: 1
      placement:
        max_replicas_per_node: 2
    restart: always

  discord-bot-service:
    container_name: discord-bot
    build:
      context: ./
      dockerfile: ./bot/Dockerfile
    environment:
      TOKEN: "OTYwNTk2OTU0Mzk0NTUwMzcy.G0QGFL.SGL4Z1Av0K8-h3c2uW-O5YFLNDawyS7SX6XCV4"
      APPLICATION_ID: "960596954394550372"
      GUILD_ID: "960452395312234536"
      MAILER_HOST: "mail.inf.upol.cz"
      MAILER_PORT: "25"
      MAILER_PASS: "Rib[Bodov0"
      DATABASE_HOST: "database"
      DATABASE_PORT: "5432"
      DATABASE_USERNAME: "root"
      DATABASE_PASSWORD: "root"
      DATABASE_NAME: "bot"
      MENZA_API: "http://menza-service:8000/"
    deploy:
      replicas: 1
      placement:
        max_replicas_per_node: 2
    restart: always
    depends_on:
      - database
      - menza-service

  menza-service:
    container_name: menza
    build:
      context: ./menza
      dockerfile: ./Dockerfile
    expose:
      - "8000"
    deploy:
      replicas: 1
      placement:
        max_replicas_per_node: 2
    restart: always
